<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>9&nbsp; Meet Your Analysis Engine: Apache Spark – The Business Analyst's Playbook: Mastering Scala, Git, and Spark from Scratch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./project.html" rel="next">
<link href="./polymorphism.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1X4L3SGHPF"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1X4L3SGHPF', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./spark.html"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Meet Your Analysis Engine: Apache Spark</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The Business Analyst’s Playbook: Mastering Scala, Git, and Spark from Scratch</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Your Lab: A Guided Tour of Databricks Notebooks</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introgit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Language of Teamwork: Mastering Git &amp; GitHub</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introprogramming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The Grammar of Programming: Variables, Functions, and Logic</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">From Business Process to Class: A New Way of Thinking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./encapsulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Encapsulation: Creating Secure Black Boxes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./errorhandling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">When Things Go Wrong: Handling Errors the Scala Way</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./traits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Families of Concepts: Inheritance with <code>traits</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polymorphism.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Many Forms, One Action: The Magic of Polymorphism</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spark.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Meet Your Analysis Engine: Apache Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final Project: A Data Analyst’s First Day</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pocketguide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">A Pocket Guide to Clean Code in Scala</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oopcookbook.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Professional’s OOP Cookbook: Practical Recipes in Java</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cheatsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">A Scala &amp; Spark Cheat Sheet</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./recommendations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Where to Go From Here? Your Compass for Lifelong Learning</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#why-spark-the-context-of-big-data" id="toc-why-spark-the-context-of-big-data" class="nav-link active" data-scroll-target="#why-spark-the-context-of-big-data"><span class="header-section-number">9.1</span> Why Spark? The Context of Big Data</a></li>
  <li><a href="#the-heart-of-spark-lazy-evaluation" id="toc-the-heart-of-spark-lazy-evaluation" class="nav-link" data-scroll-target="#the-heart-of-spark-lazy-evaluation"><span class="header-section-number">9.2</span> The Heart of Spark: Lazy Evaluation</a></li>
  <li><a href="#the-two-types-of-operations-transformations-and-actions" id="toc-the-two-types-of-operations-transformations-and-actions" class="nav-link" data-scroll-target="#the-two-types-of-operations-transformations-and-actions"><span class="header-section-number">9.3</span> The Two Types of Operations: Transformations and Actions</a></li>
  <li><a href="#hands-on-a-more-complete-example" id="toc-hands-on-a-more-complete-example" class="nav-link" data-scroll-target="#hands-on-a-more-complete-example"><span class="header-section-number">9.4</span> Hands-On: A More Complete Example</a>
  <ul class="collapse">
  <li><a href="#step-1-create-sample-data" id="toc-step-1-create-sample-data" class="nav-link" data-scroll-target="#step-1-create-sample-data"><span class="header-section-number">9.4.1</span> Step 1: Create Sample Data</a></li>
  <li><a href="#step-2-build-a-plan-with-transformations" id="toc-step-2-build-a-plan-with-transformations" class="nav-link" data-scroll-target="#step-2-build-a-plan-with-transformations"><span class="header-section-number">9.4.2</span> Step 2: Build a Plan with Transformations</a></li>
  <li><a href="#step-3-trigger-the-work-with-an-action" id="toc-step-3-trigger-the-work-with-an-action" class="nav-link" data-scroll-target="#step-3-trigger-the-work-with-an-action"><span class="header-section-number">9.4.3</span> Step 3: Trigger the Work with an Action</a></li>
  </ul></li>
  <li><a href="#practical-tips-for-beginners" id="toc-practical-tips-for-beginners" class="nav-link" data-scroll-target="#practical-tips-for-beginners"><span class="header-section-number">9.5</span> Practical Tips for Beginners</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Meet Your Analysis Engine: Apache Spark</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In our journey so far, we have learned the language of Scala and the art of modeling data with classes. We’ve worked with lists of items, like <code>List("Alice", "Bob")</code>, that fit comfortably in our computer’s memory. But what happens when our list isn’t just two names, but two <em>billion</em> names? What happens when our data file isn’t a few kilobytes, but many terabytes?</p>
<p>This is the challenge of “Big Data.” The data is simply too large to fit or be processed on a single machine. To solve this, we need to move from a single workshop to a massive, coordinated factory.</p>
<p>Welcome to <strong>Apache Spark</strong>.</p>
<section id="why-spark-the-context-of-big-data" class="level2" data-number="9.1">
<h2 data-number="9.1" class="anchored" data-anchor-id="why-spark-the-context-of-big-data"><span class="header-section-number">9.1</span> Why Spark? The Context of Big Data</h2>
<p>Modern businesses run on data. A streaming service analyzes billions of clicks to recommend your next show. A bank processes millions of transactions a minute to detect fraud. This reality is often described with three “V’s”: * <strong>Volume:</strong> The sheer amount of data is enormous. * <strong>Velocity:</strong> The data arrives incredibly fast. * <strong>Variety:</strong> The data comes in many forms—structured tables, text, images, logs.</p>
<p>A standard program on a single laptop, even a powerful one, would take days or even years to process this data, if it didn’t crash first. Spark was designed specifically to solve this problem by distributing the work across a cluster of many computers working together.</p>
<ul>
<li><strong>Analogy: The Industrial Kitchen</strong> Let’s expand our earlier analogy. Think of Spark not just as a team of chefs, but as an entire industrial food production facility.
<ul>
<li><strong>You</strong> are the <strong>Head Chef</strong>. You write the main recipe (your Spark code).</li>
<li>The <strong>Driver Node</strong> is your <strong>central office</strong>. This is where you write the recipe and where the final results are collected. The Databricks notebook you are using runs on the driver.</li>
<li>The <strong>Cluster Manager</strong> is the <strong>factory foreman</strong>, negotiating for resources.</li>
<li><strong>Executor Nodes</strong> are the individual <strong>kitchen stations</strong>. A cluster might have hundreds of these computer “stations.”</li>
<li><strong>Cores/Tasks</strong> are the <strong>cooks</strong> at each station. Each station has multiple cooks working in parallel.</li>
<li><strong>Distributed Storage</strong> (like Amazon S3 or a data lake) is the giant, shared <strong>walk-in pantry</strong>. Each kitchen station can access ingredients from this central pantry.</li>
</ul></li>
</ul>
<p>Your job is to write one master recipe. Spark’s job is to intelligently divide up the ingredients and the steps of the recipe among all the kitchen stations and cooks to get the job done with incredible speed.</p>
</section>
<section id="the-heart-of-spark-lazy-evaluation" class="level2" data-number="9.2">
<h2 data-number="9.2" class="anchored" data-anchor-id="the-heart-of-spark-lazy-evaluation"><span class="header-section-number">9.2</span> The Heart of Spark: Lazy Evaluation</h2>
<p>The single most important concept to understand about Spark is <strong>lazy evaluation</strong>.</p>
<ul>
<li><strong>Analogy: Planning a Road Trip</strong> Imagine you’re planning a multi-day road trip. You sit down with a map and write out a detailed plan:
<ol type="1">
<li><em>Plan A:</em> Drive from San Francisco to Los Angeles.</li>
<li><em>Plan B:</em> In Los Angeles, find all the taco trucks rated 4.5 stars or higher.</li>
<li><em>Plan C:</em> From that list, select the one closest to the beach.</li>
</ol>
You have created a complete <em>plan</em>. But have you started the car? Burned any gas? Eaten any tacos? No.&nbsp;You’ve done zero physical work. You’ve only built up a logical plan. You only actually <em>execute</em> the plan (start driving) when someone asks you, “Okay, where are we eating lunch?”</li>
</ul>
<p>Spark works exactly the same way. When you write code to load data and then filter it and then group it, Spark doesn’t actually do anything. It just listens to your commands and quietly builds a logical execution plan, called a <strong>Directed Acyclic Graph (DAG)</strong>. It’s a “to-do list” for the data. Spark is “lazy”—it won’t do any work until it absolutely has to.</p>
<p>This laziness is its superpower. Because it waits until the last second, it can look at your entire plan and use its powerful <strong>Catalyst Optimizer</strong> to figure out the most efficient way to get the final result, like rearranging steps or combining them to be more efficient.</p>
</section>
<section id="the-two-types-of-operations-transformations-and-actions" class="level2" data-number="9.3">
<h2 data-number="9.3" class="anchored" data-anchor-id="the-two-types-of-operations-transformations-and-actions"><span class="header-section-number">9.3</span> The Two Types of Operations: Transformations and Actions</h2>
<p>Because Spark is lazy, its operations are divided into two categories:</p>
<ol type="1">
<li><p><strong>Transformations (Lazy):</strong> These are the “planning” steps. A transformation takes a DataFrame and returns a <em>new</em> DataFrame with the transformation instruction added to the plan. They are the core of your data manipulation logic.</p></li>
<li><p><strong>Actions (Eager):</strong> These are the “do the work now” commands. An action is what triggers Spark to actually review the entire plan you’ve built and execute it across the cluster. An action is called when you want to see a result, count something, or save your data.</p></li>
</ol>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Common Transformations (Lazy)</th>
<th style="text-align: left;">What It Does (The Plan)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>select("colA", "colB")</code></td>
<td style="text-align: left;">Plans to create a new view with only the specified columns.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>filter($"colA" &gt; 100)</code></td>
<td style="text-align: left;">Plans to keep only the rows where the condition is true.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>withColumn("newCol", ...)</code></td>
<td style="text-align: left;">Plans to add a new column or replace an existing one.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>groupBy("colA")</code></td>
<td style="text-align: left;">Plans to group all rows that have the same value in <code>colA</code>. Often followed by an aggregation.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>orderBy($"colB".desc)</code></td>
<td style="text-align: left;">Plans to sort the final result based on a column.</td>
</tr>
</tbody>
</table>
<table class="caption-top table">
<colgroup>
<col style="width: 50%">
<col style="width: 50%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Common Actions (Eager)</th>
<th style="text-align: left;">What It Does (Execute Now!)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>show(10)</code></td>
<td style="text-align: left;"><strong>Executes the plan</strong> and prints the first 10 rows to the console.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>count()</code></td>
<td style="text-align: left;"><strong>Executes the plan</strong> and returns the total number of rows in the DataFrame.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>collect()</code></td>
<td style="text-align: left;"><strong>Executes the plan</strong> and brings the <em>entire</em> dataset back to the driver node as a Scala collection. <strong>(DANGER! More on this later).</strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>first()</code> / <code>take(n)</code></td>
<td style="text-align: left;"><strong>Executes the plan</strong> and returns the first row or the first <code>n</code> rows.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>write.csv(...)</code></td>
<td style="text-align: left;"><strong>Executes the plan</strong> and saves the final result to a set of files.</td>
</tr>
</tbody>
</table>
</section>
<section id="hands-on-a-more-complete-example" class="level2" data-number="9.4">
<h2 data-number="9.4" class="anchored" data-anchor-id="hands-on-a-more-complete-example"><span class="header-section-number">9.4</span> Hands-On: A More Complete Example</h2>
<p>Let’s put this all together with a more realistic data manipulation workflow in your Databricks notebook.</p>
<section id="step-1-create-sample-data" class="level3" data-number="9.4.1">
<h3 data-number="9.4.1" class="anchored" data-anchor-id="step-1-create-sample-data"><span class="header-section-number">9.4.1</span> Step 1: Create Sample Data</h3>
<p>Let’s imagine we have data about employees in a company.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> spark<span class="op">.</span>implicits<span class="op">.</span>_</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> employeeData <span class="op">=</span> <span class="bu">Seq</span><span class="op">(</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="st">"Alice"</span><span class="op">,</span> <span class="st">"Engineering"</span><span class="op">,</span> <span class="fl">120000.0</span><span class="op">),</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="st">"Bob"</span><span class="op">,</span> <span class="st">"Engineering"</span><span class="op">,</span> <span class="fl">95000.0</span><span class="op">),</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="st">"Charlie"</span><span class="op">,</span> <span class="st">"Sales"</span><span class="op">,</span> <span class="fl">80000.0</span><span class="op">),</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">4</span><span class="op">,</span> <span class="st">"David"</span><span class="op">,</span> <span class="st">"Sales"</span><span class="op">,</span> <span class="fl">75000.0</span><span class="op">),</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">5</span><span class="op">,</span> <span class="st">"Eve"</span><span class="op">,</span> <span class="st">"HR"</span><span class="op">,</span> <span class="fl">60000.0</span><span class="op">)</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> employeesDf <span class="op">=</span> employeeData<span class="op">.</span><span class="fu">toDF</span><span class="op">(</span><span class="st">"id"</span><span class="op">,</span> <span class="st">"name"</span><span class="op">,</span> <span class="st">"department"</span><span class="op">,</span> <span class="st">"salary"</span><span class="op">)</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span><span class="op">(</span><span class="st">"Initial DataFrame created. (No work done yet!)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>At this point, you have created a DataFrame, but Spark has done virtually no work. It has only noted the plan to create this data if needed.</p>
</section>
<section id="step-2-build-a-plan-with-transformations" class="level3" data-number="9.4.2">
<h3 data-number="9.4.2" class="anchored" data-anchor-id="step-2-build-a-plan-with-transformations"><span class="header-section-number">9.4.2</span> Step 2: Build a Plan with Transformations</h3>
<p>Now, let’s chain several transformations to answer a business question: “We want to give all engineers a 10% raise and see their new salary, but we only care about their name and new salary.”</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> engineeringRaisesDf <span class="op">=</span> employeesDf</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">filter</span><span class="op">(</span>$<span class="st">"department"</span> <span class="op">===</span> <span class="st">"Engineering"</span><span class="op">)</span> <span class="co">// Transformation 1: Keep only engineers</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">withColumn</span><span class="op">(</span><span class="st">"new_salary"</span><span class="op">,</span> $<span class="st">"salary"</span> <span class="op">*</span> <span class="fl">1.1</span><span class="op">)</span> <span class="co">// Transformation 2: Calculate the new salary</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span><span class="op">(</span><span class="st">"name"</span><span class="op">,</span> <span class="st">"new_salary"</span><span class="op">,</span> <span class="st">"department"</span><span class="op">)</span> <span class="co">// Transformation 3: Select only the columns we need</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">orderBy</span><span class="op">(</span>$<span class="st">"new_salary"</span><span class="op">.</span>desc<span class="op">)</span> <span class="co">// Transformation 4: Sort by the highest new salary</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span><span class="op">(</span><span class="st">"Plan with four transformations created. (Still no work done!)"</span><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>We have built a powerful, multi-step plan. The variable <code>engineeringRaisesDf</code> is a new DataFrame that contains this entire plan, but no calculations have been performed on the cluster yet.</p>
</section>
<section id="step-3-trigger-the-work-with-an-action" class="level3" data-number="9.4.3">
<h3 data-number="9.4.3" class="anchored" data-anchor-id="step-3-trigger-the-work-with-an-action"><span class="header-section-number">9.4.3</span> Step 3: Trigger the Work with an Action</h3>
<p>Now, let’s see the result. We’ll use <code>show()</code>, which is an action. This is the moment Spark looks at our four-step plan, optimizes it, sends the work to the executors, and brings the final result back to us.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span><span class="op">(</span><span class="st">"Now executing the plan with an action..."</span><span class="op">)</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>engineeringRaisesDf<span class="op">.</span><span class="fu">show</span><span class="op">()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>The output will be the result of our entire chain of logic:</p>
<pre><code>Now executing the plan with an action...
+-----+----------+-----------+
| name|new_salary| department|
+-----+----------+-----------+
|Alice|  132000.0|Engineering|
|  Bob|  104500.0|Engineering|
+-----+----------+-----------+</code></pre>
</section>
</section>
<section id="practical-tips-for-beginners" class="level2" data-number="9.5">
<h2 data-number="9.5" class="anchored" data-anchor-id="practical-tips-for-beginners"><span class="header-section-number">9.5</span> Practical Tips for Beginners</h2>
<ul>
<li><p><strong>Tip 1: In Databricks, Prefer <code>display()</code></strong> While <code>df.show()</code> is standard Spark, Databricks provides a more powerful command: <code>display(df)</code>. It renders the results in a rich, interactive table that you can sort and even plot directly. Use it whenever you’re exploring data.</p></li>
<li><p><strong>Tip 2: The Danger of <code>.collect()</code></strong> It can be tempting to use <code>df.collect()</code> to bring your data into a regular Scala <code>List</code> to work with it. <strong>BE VERY CAREFUL.</strong> The <code>.collect()</code> action pulls the <em>entire</em> dataset from all the distributed workers back to the memory of the single driver node. If your dataset has 10 billion rows, you will instantly crash your program. Use <code>.collect()</code> only on tiny, filtered datasets for debugging, or use safer actions like <code>.take(n)</code> to inspect a few rows.</p></li>
<li><p><strong>Tip 3: Chaining is Your Friend</strong> Notice how we “chained” the transformations in the example above. This is the standard, professional way to write Spark code. It’s clean, readable from top to bottom, and avoids creating lots of unnecessary intermediate variables (like <code>df1</code>, <code>df2</code>, <code>df3</code>, etc.).</p></li>
</ul>
<p>Now you understand what Spark is, why it exists, and how it thinks. You have the conceptual tools to understand transformations and actions. In the next chapter, we will use this power to complete our final project, combining Spark’s data-crunching ability with the robust, object-oriented code we’ve learned to write.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./polymorphism.html" class="pagination-link" aria-label="Many Forms, One Action: The Magic of Polymorphism">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Many Forms, One Action: The Magic of Polymorphism</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./project.html" class="pagination-link" aria-label="Final Project: A Data Analyst's First Day">
        <span class="nav-page-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final Project: A Data Analyst’s First Day</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>