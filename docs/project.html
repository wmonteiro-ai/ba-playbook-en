<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.31">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>10&nbsp; Final Project: A Data Analyst’s First Day – The Business Analyst's Playbook: Mastering Scala, Git, and Spark from Scratch</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./pocketguide.html" rel="next">
<link href="./spark.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js" type="module"></script>
<script src="site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting-e1a5c8363afafaef2c763b6775fbf3ca.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap-364982630eef5352dd1537128a8ed5cb.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-1X4L3SGHPF"></script>

<script type="text/javascript">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-1X4L3SGHPF', { 'anonymize_ip': true});
</script>


</head>

<body class="nav-sidebar floating quarto-light">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./project.html"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final Project: A Data Analyst’s First Day</span></a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">The Business Analyst’s Playbook: Mastering Scala, Git, and Spark from Scratch</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Your Lab: A Guided Tour of the Databricks Data Intelligence Platform</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introgit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">The Language of Teamwork: Mastering Git &amp; GitHub</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./introprogramming.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">The Grammar of Programming: Variables, Functions, and Logic</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./classes.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">From Business Process to Class: A New Way of Thinking</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./encapsulation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Encapsulation: Creating Secure Black Boxes</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./errorhandling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">When Things Go Wrong: Handling Errors the Scala Way</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./traits.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Families of Concepts: Inheritance with <code>traits</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./polymorphism.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">Many Forms, One Action: The Magic of Polymorphism</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./spark.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Meet Your Analysis Engine: Apache Spark</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./project.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final Project: A Data Analyst’s First Day</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./pocketguide.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">A Pocket Guide to Clean Code in Scala</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oopcookbook.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">The Professional’s OOP Cookbook: Practical Recipes in Java</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./cheatsheet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">A Scala &amp; Spark Cheat Sheet</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./recommendations.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Where to Go From Here? Your Compass for Lifelong Learning</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-scenario-your-first-assignment" id="toc-the-scenario-your-first-assignment" class="nav-link active" data-scroll-target="#the-scenario-your-first-assignment"><span class="header-section-number">10.1</span> The Scenario: Your First Assignment</a></li>
  <li><a href="#step-1-modeling-our-business-world" id="toc-step-1-modeling-our-business-world" class="nav-link" data-scroll-target="#step-1-modeling-our-business-world"><span class="header-section-number">10.2</span> Step 1: Modeling Our Business World</a></li>
  <li><a href="#step-2-gathering-the-raw-materials" id="toc-step-2-gathering-the-raw-materials" class="nav-link" data-scroll-target="#step-2-gathering-the-raw-materials"><span class="header-section-number">10.3</span> Step 2: Gathering the Raw Materials</a></li>
  <li><a href="#step-3-from-raw-data-to-a-rich-type-safe-model" id="toc-step-3-from-raw-data-to-a-rich-type-safe-model" class="nav-link" data-scroll-target="#step-3-from-raw-data-to-a-rich-type-safe-model"><span class="header-section-number">10.4</span> Step 3: From Raw Data to a Rich, Type-Safe Model</a></li>
  <li><a href="#step-4-answering-business-questions-by-combining-data" id="toc-step-4-answering-business-questions-by-combining-data" class="nav-link" data-scroll-target="#step-4-answering-business-questions-by-combining-data"><span class="header-section-number">10.5</span> Step 4: Answering Business Questions by Combining Data</a>
  <ul class="collapse">
  <li><a href="#business-question-1-who-are-our-top-10-highest-spending-customers" id="toc-business-question-1-who-are-our-top-10-highest-spending-customers" class="nav-link" data-scroll-target="#business-question-1-who-are-our-top-10-highest-spending-customers"><span class="header-section-number">10.5.1</span> <strong>Business Question 1: “Who are our top 10 highest-spending customers?”</strong></a></li>
  <li><a href="#business-question-2-which-product-categories-generate-the-most-revenue" id="toc-business-question-2-which-product-categories-generate-the-most-revenue" class="nav-link" data-scroll-target="#business-question-2-which-product-categories-generate-the-most-revenue"><span class="header-section-number">10.5.2</span> <strong>Business Question 2: “Which product categories generate the most revenue?”</strong></a></li>
  </ul></li>
  <li><a href="#step-5-visualizing-for-a-business-audience" id="toc-step-5-visualizing-for-a-business-audience" class="nav-link" data-scroll-target="#step-5-visualizing-for-a-business-audience"><span class="header-section-number">10.6</span> Step 5: Visualizing for a Business Audience</a></li>
  <li><a href="#project-debrief-connecting-our-work-to-our-principles" id="toc-project-debrief-connecting-our-work-to-our-principles" class="nav-link" data-scroll-target="#project-debrief-connecting-our-work-to-our-principles"><span class="header-section-number">10.7</span> Project Debrief: Connecting Our Work to Our Principles</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">Final Project: A Data Analyst’s First Day</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>This is it. You’ve learned the grammar of Scala, the art of modeling with classes and traits, and the immense power of Apache Spark. Now, it’s time to put it all together. This isn’t just another exercise; this is a simulation of your first big task as a newly hired Data Analyst at the online retailer, “Sparkly Goods.”</p>
<section id="the-scenario-your-first-assignment" class="level2" data-number="10.1">
<h2 data-number="10.1" class="anchored" data-anchor-id="the-scenario-your-first-assignment"><span class="header-section-number">10.1</span> The Scenario: Your First Assignment</h2>
<p>It’s your first day. The Head of Marketing comes to your desk with a crucial business problem. “Welcome to the team!” she says. “We have a lot of raw sales data, but we’re flying blind. We need to understand our customers and products better. For your first project, I need you to answer two critical questions:</p>
<ol type="1">
<li><strong>Who are our top 10 highest-spending customers by name?</strong> We want to create a loyalty program for them.</li>
<li><strong>Which product categories generate the most revenue?</strong> This will help our inventory team decide where to invest.”</li>
</ol>
<p>To answer these questions, you’ll need to combine data from three different sources: sales transactions, customer information, and product details. This is your chance to shine by using all the skills you’ve acquired. Let’s begin.</p>
</section>
<section id="step-1-modeling-our-business-world" class="level2" data-number="10.2">
<h2 data-number="10.2" class="anchored" data-anchor-id="step-1-modeling-our-business-world"><span class="header-section-number">10.2</span> Step 1: Modeling Our Business World</h2>
<p>Before we touch any data, a good analyst first builds a mental model of the business domain. We will translate that model into code using Scala’s powerful <code>case class</code>es. This gives our raw data structure, meaning, and safety.</p>
<p>We need to model three core concepts: <code>Customer</code>, <code>Product</code>, and <code>Sale</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> java<span class="op">.</span>sql<span class="op">.{</span><span class="ex">Date</span><span class="op">,</span> <span class="ex">Timestamp</span><span class="op">}</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co">// A blueprint for our customer data.</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co">// We'll use java.sql.Date for dates without time.</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">Customer</span><span class="op">(</span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>  customer_id<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>  customer_name<span class="op">:</span> <span class="ex">String</span><span class="op">,</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>  email<span class="op">:</span> <span class="ex">String</span><span class="op">,</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  signup_date<span class="op">:</span> <span class="ex">Date</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co">// A blueprint for our product catalog.</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">Product</span><span class="op">(</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>  product_id<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>  product_name<span class="op">:</span> <span class="ex">String</span><span class="op">,</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>  category<span class="op">:</span> <span class="ex">String</span><span class="op">,</span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>  unit_price<span class="op">:</span> <span class="ex">Double</span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co">// A blueprint for a single transaction.</span></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a><span class="co">// A sale connects a customer and a product.</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a><span class="co">// We'll use java.sql.Timestamp to capture the exact moment of the sale.</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a><span class="cf">case</span> <span class="kw">class</span> <span class="fu">Sale</span><span class="op">(</span></span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>  sale_id<span class="op">:</span> <span class="ex">String</span><span class="op">,</span></span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>  customer_id<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span></span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>  product_id<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span></span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>  quantity<span class="op">:</span> <span class="bu">Int</span><span class="op">,</span></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>  sale_timestamp<span class="op">:</span> <span class="ex">Timestamp</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p><strong>Context:</strong> By defining these <code>case class</code>es upfront, we are creating a “schema” for our business. This is like an architect designing the rooms of a house before construction begins. It’s a foundational step for writing clear and robust data applications.</p>
</blockquote>
</section>
<section id="step-2-gathering-the-raw-materials" class="level2" data-number="10.3">
<h2 data-number="10.3" class="anchored" data-anchor-id="step-2-gathering-the-raw-materials"><span class="header-section-number">10.3</span> Step 2: Gathering the Raw Materials</h2>
<p>In a real-world scenario, this data would live in a data lake and be stored in formats like CSV or Parquet. We’ll simulate loading three separate CSV files into Spark DataFrames.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="kw">import</span> spark<span class="op">.</span>implicits<span class="op">.</span>_</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Simulating the loading of customers.csv ---</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> customersRawDf <span class="op">=</span> <span class="bu">Seq</span><span class="op">(</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">101</span><span class="op">,</span> <span class="st">"Alice Johnson"</span><span class="op">,</span> <span class="st">"alice@example.com"</span><span class="op">,</span> <span class="st">"2024-01-15"</span><span class="op">),</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">102</span><span class="op">,</span> <span class="st">"Bob Williams"</span><span class="op">,</span> <span class="st">"bob@example.com"</span><span class="op">,</span> <span class="st">"2024-02-20"</span><span class="op">),</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">103</span><span class="op">,</span> <span class="st">"Charlie Brown"</span><span class="op">,</span> <span class="st">"charlie@example.com"</span><span class="op">,</span> <span class="st">"2024-03-05"</span><span class="op">)</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a><span class="op">).</span><span class="fu">toDF</span><span class="op">(</span><span class="st">"customer_id"</span><span class="op">,</span> <span class="st">"customer_name"</span><span class="op">,</span> <span class="st">"email"</span><span class="op">,</span> <span class="st">"signup_date"</span><span class="op">)</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">withColumn</span><span class="op">(</span><span class="st">"signup_date"</span><span class="op">,</span> $<span class="st">"signup_date"</span><span class="op">.</span><span class="fu">cast</span><span class="op">(</span><span class="st">"date"</span><span class="op">))</span> <span class="co">// Casting string to a proper Date type</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Simulating the loading of products.csv ---</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> productsRawDf <span class="op">=</span> <span class="bu">Seq</span><span class="op">(</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">1</span><span class="op">,</span> <span class="st">"Scala Handbook"</span><span class="op">,</span> <span class="st">"Books"</span><span class="op">,</span> <span class="fl">29.99</span><span class="op">),</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">2</span><span class="op">,</span> <span class="st">"Spark Mug"</span><span class="op">,</span> <span class="st">"Kitchenware"</span><span class="op">,</span> <span class="fl">12.50</span><span class="op">),</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="dv">3</span><span class="op">,</span> <span class="st">"Data T-Shirt"</span><span class="op">,</span> <span class="st">"Apparel"</span><span class="op">,</span> <span class="fl">24.00</span><span class="op">)</span></span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="op">).</span><span class="fu">toDF</span><span class="op">(</span><span class="st">"product_id"</span><span class="op">,</span> <span class="st">"product_name"</span><span class="op">,</span> <span class="st">"category"</span><span class="op">,</span> <span class="st">"unit_price"</span><span class="op">)</span></span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="co">// --- Simulating the loading of sales.csv ---</span></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> salesRawDf <span class="op">=</span> <span class="bu">Seq</span><span class="op">(</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="st">"s1"</span><span class="op">,</span> <span class="dv">101</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="st">"2025-06-10 10:00:00"</span><span class="op">),</span></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="st">"s2"</span><span class="op">,</span> <span class="dv">102</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">"2025-06-11 11:30:00"</span><span class="op">),</span></span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="st">"s3"</span><span class="op">,</span> <span class="dv">101</span><span class="op">,</span> <span class="dv">2</span><span class="op">,</span> <span class="dv">5</span><span class="op">,</span> <span class="st">"2025-06-12 14:00:00"</span><span class="op">),</span></span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="st">"s4"</span><span class="op">,</span> <span class="dv">103</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">"2025-06-13 09:00:00"</span><span class="op">),</span></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a>  <span class="op">(</span><span class="st">"s5"</span><span class="op">,</span> <span class="dv">101</span><span class="op">,</span> <span class="dv">3</span><span class="op">,</span> <span class="dv">1</span><span class="op">,</span> <span class="st">"2025-06-14 16:00:00"</span><span class="op">)</span></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="op">).</span><span class="fu">toDF</span><span class="op">(</span><span class="st">"sale_id"</span><span class="op">,</span> <span class="st">"customer_id"</span><span class="op">,</span> <span class="st">"product_id"</span><span class="op">,</span> <span class="st">"quantity"</span><span class="op">,</span> <span class="st">"sale_timestamp"</span><span class="op">)</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a> <span class="op">.</span><span class="fu">withColumn</span><span class="op">(</span><span class="st">"sale_timestamp"</span><span class="op">,</span> $<span class="st">"sale_timestamp"</span><span class="op">.</span><span class="fu">cast</span><span class="op">(</span><span class="st">"timestamp"</span><span class="op">))</span> <span class="co">// Casting string to Timestamp</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p><strong>Tip: Always Check Your Schema!</strong> The very first thing a data analyst does after loading data is inspect its structure using <code>printSchema()</code>. This tells you the column names and the data types Spark inferred. It’s an essential debugging step.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>customersRawDf<span class="op">.</span><span class="fu">printSchema</span><span class="op">()</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>productsRawDf<span class="op">.</span><span class="fu">printSchema</span><span class="op">()</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>salesRawDf<span class="op">.</span><span class="fu">printSchema</span><span class="op">()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</blockquote>
</section>
<section id="step-3-from-raw-data-to-a-rich-type-safe-model" class="level2" data-number="10.4">
<h2 data-number="10.4" class="anchored" data-anchor-id="step-3-from-raw-data-to-a-rich-type-safe-model"><span class="header-section-number">10.4</span> Step 3: From Raw Data to a Rich, Type-Safe Model</h2>
<p>Now we perform the magic step that connects our OOP models with Spark’s raw data. We convert our generic <code>DataFrame</code>s into strongly-typed <code>Dataset</code>s. This gives us “compiler-time safety”—if we misspell a field name later, our code won’t even compile, saving us from runtime errors.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> customersDs <span class="op">=</span> customersRawDf<span class="op">.</span>as<span class="op">[</span>Customer<span class="op">]</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> productsDs <span class="op">=</span> productsRawDf<span class="op">.</span>as<span class="op">[</span>Product<span class="op">]</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> salesDs <span class="op">=</span> salesRawDf<span class="op">.</span>as<span class="op">[</span>Sale<span class="op">]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Our data is now loaded, structured, and safe. We are ready to answer the business questions.</p>
</section>
<section id="step-4-answering-business-questions-by-combining-data" class="level2" data-number="10.5">
<h2 data-number="10.5" class="anchored" data-anchor-id="step-4-answering-business-questions-by-combining-data"><span class="header-section-number">10.5</span> Step 4: Answering Business Questions by Combining Data</h2>
<p>This is where data analysis truly happens: by enriching and combining different datasets to uncover insights.</p>
<section id="business-question-1-who-are-our-top-10-highest-spending-customers" class="level3" data-number="10.5.1">
<h3 data-number="10.5.1" class="anchored" data-anchor-id="business-question-1-who-are-our-top-10-highest-spending-customers"><span class="header-section-number">10.5.1</span> <strong>Business Question 1: “Who are our top 10 highest-spending customers?”</strong></h3>
<p>To answer this, we need to connect sales to products (to get the price) and then to customers (to get their names).</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 4a: Calculate the revenue for each individual sale</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> salesWithRevenueDf <span class="op">=</span> salesDs</span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">join</span><span class="op">(</span>productsDs<span class="op">,</span> <span class="fu">salesDs</span><span class="op">(</span><span class="st">"product_id"</span><span class="op">)</span> <span class="op">===</span> <span class="fu">productsDs</span><span class="op">(</span><span class="st">"product_id"</span><span class="op">))</span> <span class="co">// Join sales and products</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">withColumn</span><span class="op">(</span><span class="st">"total_price"</span><span class="op">,</span> $<span class="st">"quantity"</span> <span class="op">*</span> $<span class="st">"unit_price"</span><span class="op">)</span> <span class="co">// Calculate the total price for the transaction</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span><span class="op">(</span><span class="st">"Enriched sales data with total price per transaction:"</span><span class="op">)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>salesWithRevenueDf<span class="op">.</span><span class="fu">select</span><span class="op">(</span><span class="st">"sale_id"</span><span class="op">,</span> <span class="st">"product_name"</span><span class="op">,</span> <span class="st">"quantity"</span><span class="op">,</span> <span class="st">"unit_price"</span><span class="op">,</span> <span class="st">"total_price"</span><span class="op">).</span><span class="fu">show</span><span class="op">()</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co">// Step 4b: Aggregate revenue by customer and join to get customer names</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> customerSpendingDf <span class="op">=</span> salesWithRevenueDf</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">groupBy</span><span class="op">(</span><span class="st">"customer_id"</span><span class="op">)</span> <span class="co">// Group all transactions by customer</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">sum</span><span class="op">(</span><span class="st">"total_price"</span><span class="op">)</span> <span class="co">// For each customer, sum up the total_price</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">withColumnRenamed</span><span class="op">(</span><span class="st">"sum(total_price)"</span><span class="op">,</span> <span class="st">"total_spent"</span><span class="op">)</span> <span class="co">// Rename the aggregated column for clarity</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">join</span><span class="op">(</span>customersDs<span class="op">,</span> <span class="st">"customer_id"</span><span class="op">)</span> <span class="co">// Join with the customer dataset to get names</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">select</span><span class="op">(</span><span class="st">"customer_name"</span><span class="op">,</span> <span class="st">"total_spent"</span><span class="op">)</span> <span class="co">// Select only the final columns we need</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">orderBy</span><span class="op">(</span>$<span class="st">"total_spent"</span><span class="op">.</span>desc<span class="op">)</span> <span class="co">// Sort to find the top spenders</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span><span class="op">(</span><span class="st">"Final Customer Spending Report:"</span><span class="op">)</span></span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a>customerSpendingDf<span class="op">.</span><span class="fu">show</span><span class="op">(</span><span class="dv">10</span><span class="op">)</span> <span class="co">// Show the top 10</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="business-question-2-which-product-categories-generate-the-most-revenue" class="level3" data-number="10.5.2">
<h3 data-number="10.5.2" class="anchored" data-anchor-id="business-question-2-which-product-categories-generate-the-most-revenue"><span class="header-section-number">10.5.2</span> <strong>Business Question 2: “Which product categories generate the most revenue?”</strong></h3>
<p>We can reuse our <code>salesWithRevenueDf</code> from the previous question. This is a common and efficient practice.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">val</span> categoryRevenueDf <span class="op">=</span> salesWithRevenueDf</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">groupBy</span><span class="op">(</span><span class="st">"category"</span><span class="op">)</span> <span class="co">// This time, group by the product category</span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">sum</span><span class="op">(</span><span class="st">"total_price"</span><span class="op">)</span> <span class="co">// Sum up the revenue for each category</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">withColumnRenamed</span><span class="op">(</span><span class="st">"sum(total_price)"</span><span class="op">,</span> <span class="st">"total_revenue"</span><span class="op">)</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">.</span><span class="fu">orderBy</span><span class="op">(</span>$<span class="st">"total_revenue"</span><span class="op">.</span>desc<span class="op">)</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">println</span><span class="op">(</span><span class="st">"Product Category Revenue Report:"</span><span class="op">)</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>categoryRevenueDf<span class="op">.</span><span class="fu">show</span><span class="op">()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
</section>
<section id="step-5-visualizing-for-a-business-audience" class="level2" data-number="10.6">
<h2 data-number="10.6" class="anchored" data-anchor-id="step-5-visualizing-for-a-business-audience"><span class="header-section-number">10.6</span> Step 5: Visualizing for a Business Audience</h2>
<p>An analyst’s job isn’t done until the insights are communicated clearly. A table of numbers is good, but a chart is often better. In Databricks, we can use the <code>display()</code> command to create interactive visualizations.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode scala code-with-copy"><code class="sourceCode scala"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co">// Use display() to get a richer, interactive output</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">display</span><span class="op">(</span>categoryRevenueDf<span class="op">)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<blockquote class="blockquote">
<p><strong>Actionable Tip:</strong> When you run the <code>display()</code> command in a Databricks notebook, a rich table will appear. Below the table, click the <strong>“Plot”</strong> icon (which looks like a bar chart). 1. In the plot options, you can drag and drop fields. 2. Drag the <code>category</code> column to the “Keys” box. 3. Drag the <code>total_revenue</code> column to the “Values” box. 4. Choose the bar chart display type. You have just created a presentation-ready chart to show the marketing team, directly from your analysis results!</p>
</blockquote>
</section>
<section id="project-debrief-connecting-our-work-to-our-principles" class="level2" data-number="10.7">
<h2 data-number="10.7" class="anchored" data-anchor-id="project-debrief-connecting-our-work-to-our-principles"><span class="header-section-number">10.7</span> Project Debrief: Connecting Our Work to Our Principles</h2>
<p>Let’s step back and reflect. We didn’t just run some commands; we completed a professional workflow that successfully leveraged every concept from this book.</p>
<ul>
<li><strong>We started with OOP:</strong> By creating <code>case class</code>es, we built a robust, type-safe model of our business domain. This made our subsequent code far easier to read and less prone to errors.</li>
<li><strong>We used Spark for large-scale processing:</strong> We performed powerful <code>join</code> and <code>groupBy</code> operations that would work efficiently even on billions of rows, thanks to Spark’s distributed engine.</li>
<li><strong>We wrote Clean Code:</strong> Our analysis was a declarative, chained series of transformations, making the logic clear and readable from top to bottom.</li>
<li><strong>We focused on business value:</strong> We didn’t just manipulate data; we answered specific, important questions from our stakeholders and prepared the results for presentation.</li>
</ul>
<p>You have successfully completed your first day as a Data Analyst at “Sparkly Goods.” You took raw data from multiple sources, combined it, and extracted valuable, actionable insights. This entire project is a blueprint you can adapt and reuse for countless data challenges in your career.</p>
<p>Congratulations!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./spark.html" class="pagination-link" aria-label="Meet Your Analysis Engine: Apache Spark">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">Meet Your Analysis Engine: Apache Spark</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./pocketguide.html" class="pagination-link" aria-label="A Pocket Guide to Clean Code in Scala">
        <span class="nav-page-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">A Pocket Guide to Clean Code in Scala</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>